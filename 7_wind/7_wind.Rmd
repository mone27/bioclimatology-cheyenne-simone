---
title: "7th Protocol: Wind"
author: "Cheyenne Rueda and Simone Massaro"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  pdf_document:
    toc: true
    number_sections: true
    includes:
      in_header: "../preamble.tex"
  html_notebook:
    number_sections: true
header-includes:
  - \fancyhead[L]{Longwave radiation}
editor_options: 
  markdown: 
    wrap: 72
---

# Motivation

# Background

# Sensors and measuring principle

averaging suing vector average [@grange_technical_2014]

# Analysis

```{r}
library(tidyverse)
library(lubridate)
```
```{r}
wind <- read_csv(here::here("Data_lectures/7_Wind/Winddata_Botanical_garden.csv")) %>% 
  drop_na() %>% 
  rename(WS_0.5m = WS_05m)
```

1st step is to split the wind direction into its vectors. 

```{r}
deg2rad <- function(deg) deg * pi / 180
rad2deg <- function(rad) rad * 180 / pi

# calculates the wind angular average over the provide input.
# intend to be used together with group_by and summarize
wind_dir_average <- function(wd){
  dir <- deg2rad(wd)
  # calc the vector components and then make the mean
  u <- cos(dir) %>% mean
  v <- sin(dir) %>% mean
  # convert back to a direction. Note atan2 uses y,x
  avg_dir <- atan2(v, u)
  # need to convert in 0 - 360 range
  avg_dir <- avg_dir %% (2*pi)
  return(rad2deg(avg_dir))
}

```

1. Calculate 1 hour averages of 10 minute mean wind speed and direction
data. Remember vectorial averaging!

```{r}
wind_1h <- wind %>%
  group_by(round_date(Date, unit = "1 hour")) %>%
  summarise(across(-WD_deg, mean), WD_deg = wind_dir_average(WD_deg))
```

```{r}
wind_1h
```

Visually checking the wind averages (comment from Simone I'd actually delete this plot)

```{r}
wind %>%
  filter(week(Date)==1) %>%
ggplot()+
  geom_line(aes(Date, WD_deg), colour="lightblue") +
  geom_line(aes(Date, WD_deg), data=filter(wind_1h, week(Date)==1))

```
2. How does the wind speed change with height? Characterize the wind
pattern in different heights at the botanical garden. (wind rose)

```{r}
wind_m<- wind %>%
group_by(yday(Date)) %>%
summarise_all(mean)
```

```{r}
windspeed <- ggplot(wind_m)+
  geom_line(aes(Date, WS_0.5m), colour="yellow")+
  geom_line(aes(Date, WS_1m), colour="blue")+
  geom_line(aes(Date, WS_2m), colour="orange")+
  geom_line(aes(Date, WS_5m), colour="green")+
  geom_line(aes(Date, WS_10m), colour="brown") +
  labs(y = "Wind speed", x = "1 year", color = "")
#windspeed
```

As it is possible to appreciate in the graph, wind speed gets faster at 10m height. This makes sense when having in mind the vertical wind profile graph that increases with height. 

```{r}
## plotting the same thing using gather
wind_m %>%
  #just one month otherwise the plot is too compressed
  filter(between(Date, as_datetime("2020-03-01") , as_datetime("2020-04-01") )) %>% 
  gather("height", "windspeed", WS_0.5m, WS_1m, WS_2m, WS_5m, WS_10m) %>% 
  ggplot(aes(Date, windspeed, col=height))+
  geom_line()
```

```{r}
wind %>% 
  gather("height", "windspeed", WS_0.5m, WS_1m, WS_2m, WS_5m, WS_10m) %>% 
  # converts the height into a numeric value
  mutate(height = as.numeric(gsub(".*?([0-9]+).*", "\\1", height))) %>%
  ggplot(aes(windspeed, height, group=height)) +
  geom_boxplot()
```

comment from Simone. I'd keep this plot

```{r}
wind_m %>%
  gather("height", "windspeed", WS_0.5m, WS_1m, WS_2m, WS_5m, WS_10m) %>% 
  mutate(height = as.numeric(gsub(".*?([0-9]+).*", "\\1", height))) %>% 
  ggplot(aes(windspeed, height, group=height)) +
  geom_boxplot()
```

```{r}
library(clifro)
```

```{r}
windrose(wind$WS_10m, wind$WD_deg, col_pal="YlGnBu")
```



3. How does the wind speed varies over the year and what can explain the
variability?

```{r}
ggplot(wind_m, aes(Date, WS_10m)) +
  geom_line()
```


The graphs displays the variation of the wind speed along year. It is faster from end of december to beginning of april. During summer the mean wind speed is lower but some days it gets faster than others. This variability is originated depending on when the wind is coming from. Also temperature may influence wind speed. 



# References